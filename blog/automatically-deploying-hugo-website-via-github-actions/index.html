<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Automatically Deploying A Hugo Website via GitHub Actions - Gunnar Morling</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Automatically Deploying A Hugo Website via GitHub Actions" />
<meta property="og:description" content="As a software engineer, I like to automate tedious tasks as much as possible. The deployment of this website is no exception: it is built using Hugo and hosted on GitHub pages; so wouldn&#39;t it be nice if the rendered website would automatically be published whenever an update is pushed to its source code repository?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.morling.dev/blog/automatically-deploying-hugo-website-via-github-actions/" />
<meta property="article:published_time" content="2019-12-26T10:00:00+01:00" />
<meta property="article:modified_time" content="2019-12-26T10:00:00+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Automatically Deploying A Hugo Website via GitHub Actions"/>
<meta name="twitter:description" content="As a software engineer, I like to automate tedious tasks as much as possible. The deployment of this website is no exception: it is built using Hugo and hosted on GitHub pages; so wouldn&#39;t it be nice if the rendered website would automatically be published whenever an update is pushed to its source code repository?"/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="https://www.morling.dev/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.morling.dev/css/main.css" />

	
	<link rel="stylesheet" type="text/css" href="https://www.morling.dev/css/base16.dark.css" />
	
	<link rel="stylesheet" type="text/css" href="https://www.morling.dev/css/morlingdev.css" />
	

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
	<script src="https://www.morling.dev/js/main.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>

			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/">Blog</a>
						</li>
						
						<li>
							<a href="/projects">Projects</a>
						</li>
						
						<li>
							<a href="/conferences">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts">Podcasts</a>
						</li>
						
						<li>
							<a href="/about">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<ul class="flat"><a href="https://github.com/gunnarmorling" title="GitHub"><i data-feather="github"></i></a><a href="https://twitter.com/gunnarmorling" title="Twitter"><i data-feather="twitter"></i></a><a href="https://gitlab.com/gunnar.morling" title="GitLab"><i data-feather="gitlab"></i></a></ul>
				</div>
			</nav>
		</div>
	</div>
</div>


		<div class="post-header">
			<h1 class="title">Automatically Deploying A Hugo Website via GitHub Actions</h1>
			<div class="meta">Posted at Dec 26, 2019</div>
		</div>

		<div class="markdown">
			<div class="paragraph">
<p>As a software engineer, I like to automate tedious tasks as much as possible.
The deployment of this website is no exception:
it is built using the <a href="https://gohugo.io/">Hugo</a> static site generator and hosted on <a href="https://pages.github.com/">GitHub Pages</a>;
so wouldn&#8217;t it be nice if the rendered website would automatically be published whenever an update is pushed to its source code repository?</p>
</div>
<div class="paragraph">
<p>With the advent of <a href="https://github.com/features/actions">GitHub Actions</a>, tasks like this can easily be implemented without having to rely on any external CI service.
Instead, many ready-made actions can be obtained from the <a href="https://github.com/marketplace?type=actions">GitHub marketplace</a> and easily be configured as per our needs.
E.g. triggered by a push to a specified branch in a GitHub repository,
they can execute tasks like project builds, tests and many others,
running in virtual machines based on Linux, Windows and even macOS.
So let&#8217;s see what&#8217;s needed for building a Hugo website and deploying it to GitHub Pages.</p>
</div>
<div class="sect1">
<h2 id="_github_actions_to_the_rescue">GitHub Actions To the Rescue</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using my favourite search engine,
I came across two GitHub actions which do everything we need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/marketplace/actions/hugo-setup">GitHub Actions for Hugo</a></p>
</li>
<li>
<p><a href="https://github.com/marketplace/actions/github-pages-action">GitHub Actions for GitHub Pages</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There <a href="https://github.com/marketplace/actions/deploy-to-github-pages">are</a> <a href="https://github.com/marketplace/actions/github-pages-deploy">multiple</a> <a href="https://github.com/marketplace/actions/github-pages">alternatives</a> for GitHub Pages deployment.
I chose this one basically because it seems to be the most popular one (as per number of GitHub stars), and because it&#8217;s by the same author as the Hugo one, so they should nicely play together.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_registering_a_deploy_key">Registering a Deploy Key</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order for the GitHub action to deploy the website,
a GitHub <a href="https://developer.github.com/v3/guides/managing-deploy-keys/">deploy key</a> must be registered.</p>
</div>
<div class="paragraph">
<p>To do so, create a new SSH key pair on your machine like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-b</span> 4096 <span class="nt">-C</span> <span class="s2">"</span><span class="si">$(</span>git config user.email<span class="si">)</span><span class="s2">"</span> <span class="nt">-f</span> gh-pages <span class="nt">-N</span> <span class="s2">""</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create two files, the public key (<em>gh-pages.pub</em>) and the private key (<em>gh-pages</em>).
Go to <a href="https://github.com/&lt;your-user-or-organisation&gt;/&lt;your-repo&gt;/settings/keys" class="bare">https://github.com/&lt;your-user-or-organisation&gt;/&lt;your-repo&gt;/settings/keys</a> and click "Add deploy key".
Paste in the <strong>public</strong> part of your key pair and check the "Allow write access" box.</p>
</div>
<div class="paragraph">
<p>No go to <a href="https://github.com/&lt;your-user-or-organisation&gt;/&lt;your-repo&gt;/settings/secrets" class="bare">https://github.com/&lt;your-user-or-organisation&gt;/&lt;your-repo&gt;/settings/secrets</a> and click "Add new secret". Choose <code>ACTIONS_DEPLOY_KEY</code> as the name and paste the <strong>private</strong> part of your key pair into the "Value" field.</p>
</div>
<div class="paragraph">
<p>The key will be stored in an encrypted way as per GitHub&#8217;s documentation
Nevertheless I&#8217;d recommend to use a specific key pair just for this purpose, instead of re-using any other key pair.
That way, impact will be reduced to this particular usage, should the private key get leaked somehow.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_defining_the_workflow">Defining the Workflow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the key in place, it&#8217;s time to set up the actual GitHub Actions workflow.
This is simply done by creating the file <em>.github/workflows/gh-pages-deployment.yml</em> in your repository with the following contents.
GitHub Actions workflows are YAML files, because <a href="https://twitter.com/brunoborges/status/1098472238469111808">YOLO</a> ;)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">GitHub Pages</span>

<span class="na">on</span><span class="pi">:</span>                                              <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">master</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build-deploy</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-18.04</span>
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v1</span>                  <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">submodules</span><span class="pi">:</span> <span class="no">true</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Ruby Dev</span>                     <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="na">run</span><span class="pi">:</span> <span class="s">sudo apt-get install ruby-dev</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install AsciiDoctor and Rouge</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">sudo gem install asciidoctor rouge</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Hugo</span>                           <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">peaceiris/actions-hugo@v2</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">hugo-version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.57.2'</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build</span>                                <i class="conum" data-value="5"></i><b>(5)</b>
      <span class="na">run</span><span class="pi">:</span> <span class="s">hugo</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy</span>                               <i class="conum" data-value="6"></i><b>(6)</b>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">peaceiris/actions-gh-pages@v2</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="na">ACTIONS_DEPLOY_KEY</span><span class="pi">:</span> <span class="s">${{ secrets.ACTIONS_DEPLOY_KEY }}</span>
        <span class="na">PUBLISH_BRANCH</span><span class="pi">:</span> <span class="s">gh-pages</span>
        <span class="na">PUBLISH_DIR</span><span class="pi">:</span> <span class="s">./public</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Run this action whenever changes are pushed to the <em>master</em> branch</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The first step in the job: check out the source code</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Install <a href="https://asciidoctor.org/">AsciiDoctor</a> (in case you use Hugo with AsciiDoc files, like I do) and <a href="https://github.com/rouge-ruby/rouge">Rouge</a>, a Ruby gem for syntax highlighting; I&#8217;m installing the gems instead of Ubuntu packages in order to get current versions</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Set up Hugo via the aforementioned GitHub Actions for Hugo</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Run the <code>hugo</code> command; here you could add parameters such as <code>-F</code> for also building future posts</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Deploy the website to GitHub pages; the contents of Hugo&#8217;s build directory <em>public</em> will be pushed to the <em>gh-pages</em> branch of the upstream repository, using the deploy key configured before</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And that&#8217;s all we need; once the file is committed and pushed to the upstream repository,
the deployment workflow will be executed upon each push to the master branch.</p>
</div>
<div class="paragraph">
<p>You can find the complete workflow definition used for publishing this website <a href="https://github.com/gunnarmorling/morling.dev/blob/master/.github/workflows/gh-pages-deployment.yml">here</a>.
Also check out the documentation of <a href="https://github.com/marketplace/actions/hugo-setup">GitHub Actions for Hugo</a> and <a href="https://github.com/marketplace/actions/github-pages-action">GitHub Actions for GitHub Pages</a> to learn more about their capabilities and the options they offer.</p>
</div>
</div>
</div>

		</div>

		<div class="post-tags">
			
				
			
		</div></div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © 2019 Gunnar Morling |  Built with <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a></div>
	</nav>
</div>

<script>feather.replace()</script>
</body>
</html>
